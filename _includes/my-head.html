<!-- Add HTML tags here to be included in the head. You can delete the below: -->
<link rel="dns-prefetch" href="https://assets.gumroad.com">
<script type="module">
  const loadJS = x => new Promise(r => window.loadJS(x).addEventListener('load', r));

  let p1, p2, io1, io2, embedCreated, overlayCreated;
  document.querySelector('hy-push-state').addEventListener('load', () => {
    io1 ||= new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p1 = p1 || loadJS('https://gumroad.com/js/gumroad-embed.js');
        await p1;
        !embedCreated && await new Promise(function check1(res) {
          if (typeof createGumroadEmbed !== 'undefined')  {
            embedCreated = 1;
            res(createGumroadEmbed());
          }
          else setTimeout(() => check1(res), 200);
        });
        await new Promise(function check2(res) {
          if (typeof GumroadEmbed !== 'undefined') res(GumroadEmbed.reload());
          else setTimeout(() => check2(res), 200);
        });
      }
    }, { rootMargin: '1440px' });

    io2 ||= new IntersectionObserver(async (entries) => {
      if (entries.some(x => x.isIntersecting)) {
        p2 = p2 || loadJS('https://gumroad.com/js/gumroad.js');
        await p2;
        !overlayCreated && await new Promise(function check(res) {
          if (typeof createGumroadOverlay !== 'undefined') {
            overlayCreated = 1;
            res(createGumroadOverlay());
          }
          else setTimeout(() => check(res), 200);
        });
      }
    }, { rootMargin: '300px' });

    document.querySelectorAll('.gumroad-product-embed').forEach(el => io1.observe(el));
    document.querySelectorAll('.gumroad-button').forEach(el => io2.observe(el));
  });
</script>


<link rel="stylesheet" href="{{ '/assets/css/custom.css' | relative_url }}">


<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll("a[data-fig-ref]").forEach(function (link) {
      const figId = link.getAttribute("href").substring(1);
      const fig = document.getElementById(figId);
      const caption = fig?.querySelector("figcaption");
      if (caption) {
        const figText = caption.textContent;
        const match = figText.match(/Figure\s+(\d+)/);
        if (match) {
          link.textContent = "Figure " + match[1];
        }
      }
    });
  });
</script>



<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Get all figures and create a lookup map of their order
    const figures = Array.from(document.querySelectorAll("figure"));
    const figureMap = new Map();

    figures.forEach((fig, index) => {
      const id = fig.id;
      if (id) {
        figureMap.set(id, index + 1); // 1-based numbering
      }
    });

    // Replace the link text with the actual figure number
    document.querySelectorAll("a[data-fig-ref]").forEach(function (link) {
      const figId = link.getAttribute("href").substring(1);
      if (figureMap.has(figId)) {
        const number = figureMap.get(figId);
        link.textContent = "Figure " + number;
      } else {
        link.textContent = "Figure ??";
      }
    });
  });
</script>



